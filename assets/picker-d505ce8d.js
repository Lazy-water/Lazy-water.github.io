import{a as B,c as P,F as z}from"./helper-1e979f21.js";import{F as A}from"./popup-0f269fc4.js";import{F as N}from"./text-3debc4c0.js";import{B as $,y as T,C as D,u as g,o as m,a as V,d as y,F,b as I,n as M,t as p,i as H,I as O,D as Y,J as j,r as b,c as K,w as x,h as q,e as S,g as w,q as J,E as L}from"./vue-libs-eb153a24.js";import{_ as E}from"./locales-2658cfbc.js";const U=$({options:{virtualHost:!0},props:{items:Array,value:Array,index:Number,valueKey:String},emits:["selectItem"],setup(e,{emit:u}){const n=T(110),d=T(),r=T();let f=0,c=n.value;const h=D(()=>{const a=`transform: translate3d(0, ${n.value}px, 0)`;return B(a)}),v=a=>{d.value=null,r.value=null,f=a.touches[0].screenY,c=n.value},_=a=>{if(!e.items.find(s=>!s.disabled))return;const t=a.touches[0].screenY;t>f?n.value=c+(t-f):n.value=c-(f-t)},l=a=>{var i;if(!(a!=null&&a.find(k=>!k.disabled)))return;let t=Number(String(Math.floor(n.value/44)-2).replace(/\-/g,""));if(typeof r.value=="number"&&(t=r.value),t>e.items.length-1?t=e.items.length-1:n.value>110&&(n.value=110,t=0),a&&((i=a[t])!=null&&i.disabled)){r.value=t+=1,r.value>=a.length&&(r.value-=2),l(a);return}n.value=110-t*44;let s=t;e.valueKey&&(s=a[t][e.valueKey]),d.value=s,u("selectItem",{level:e.index,select:s,index:t})},o=(a,t)=>{a.disabled||(r.value=t,l(e.items))};return g(()=>e.value,a=>{let t=!1;a.length&&a.some(i=>!!i)&&(t=!0);const s=[...a];if(t&&d.value!==s[e.index]){d.value=s[e.index];const i=e.items.findIndex((k,C)=>e.valueKey?k[e.valueKey]===d.value:C===d.value);r.value=i>=0?i:0,l(e.items)}},{immediate:!0,deep:!0}),{currentOffset:n,colStyle:h,onTouchstart:v,onTouchmove:_,onTouchEnd:l,onClick:o}}}),G=["onClick"],Q={class:"fan-ellipsis"};function R(e,u,n,d,r,f){return m(),V("div",{class:"fan-picker__box",onTouchstart:u[0]||(u[0]=(...c)=>e.onTouchstart&&e.onTouchstart(...c)),onTouchmove:u[1]||(u[1]=O((...c)=>e.onTouchmove&&e.onTouchmove(...c),["prevent"])),onTouchend:u[2]||(u[2]=c=>e.onTouchEnd(e.items)),onTouchcancel:u[3]||(u[3]=c=>e.onTouchEnd(e.items))},[y("div",{class:"fan-picker__l",style:H(e.colStyle)},[(m(!0),V(F,null,I(e.items,(c,h)=>(m(),V("div",{key:h,class:M(["fan-flex-center fan-picker__txt",{"fan-picker__d":c.disabled}]),onClick:v=>e.onClick(c,h)},[y("div",Q,p(c.text),1)],10,G))),128))],4)],32)}const W=E(U,[["render",R]]);const X=$({name:P("Picker")[0],options:{virtualHost:!0},emits:["confirm","cancel","update:modelValue","update:show"],components:{FanPopup:A,FanButton:z,FanText:N,PickerColumn:W},props:{modelValue:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},title:String,cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"确认"},data:Array,valueKey:String,textKey:{type:String,default:"text"}},setup(e,{emit:u}){const n=Y({innerShow:e.show,list:[],selectValue:e.modelValue&&e.modelValue.length?[...e.modelValue]:[]});let d=!1;const r=L(),f=l=>{if(n.selectValue[l.level]!==l.select&&(n.selectValue[l.level]=l.select,d)){const o=n.list[l.level][l.index];n.list.splice(l.level+1,n.list.length),o!=null&&o.children&&(o!=null&&o.children.length)&&v({data:o.children,key:e.textKey,arr:n.list}),n.list.forEach((a,t)=>{var s;t>l.level&&(n.selectValue[t]=(s=n.list[t])==null?void 0:s.findIndex(i=>!i.disabled),J(()=>{r.refs.column.sort((k,C)=>k.index-C.index)[t].onTouchEnd(n.list[t])}))})}},c=()=>u("confirm",n.selectValue),h=()=>{n.innerShow=!1,u("cancel")},v=({data:l,key:o,arr:a})=>{const t=l.map(s=>({text:s[o],disabled:!!(s!=null&&s.disabled),[e.valueKey]:s[e.valueKey],children:s.children}));a.push(t),t[0].children&&t[0].children.length&&v({data:t[0].children,key:o,arr:a})},_=({data:l,key:o,arr:a})=>{l&&l.length&&(typeof l[0]=="string"?(n.selectValue.length||(n.selectValue=[0]),a.push(l.map(t=>({text:t,disabled:!1})))):Array.isArray(l[0])?(l.forEach((t,s)=>{a.push([]),t.forEach(i=>{a[s].push({disabled:!!(i!=null&&i.disabled),text:i[o],[e.valueKey]:i[e.valueKey]})})}),n.selectValue.length||(n.selectValue=[],a.forEach(t=>{const s=t.findIndex(i=>{if(!i.disabled)return!0});n.selectValue.push(e.valueKey?t[s][e.valueKey]:s)}))):(d=!0,v({data:l,key:o,arr:a}),n.selectValue.length||(n.selectValue=[],setTimeout(()=>{n.list.forEach(t=>{const s=t.findIndex(i=>{if(!i.disabled)return!0});n.selectValue.push(e.valueKey?t[s][e.valueKey]:s)})},0))))};return g(()=>e.modelValue,l=>{l&&(n.selectValue=[...l])},{deep:!0}),g(()=>n.selectValue,l=>{let o=!1;l.find((a,t)=>a!==e.modelValue[t])&&(o=!0),o&&u("update:modelValue",l)},{deep:!0}),g(()=>e.show,l=>n.innerShow=l),g(()=>n.innerShow,l=>u("update:show",l)),j(()=>{const l=[];_({data:e.data,key:e.textKey,arr:l}),n.list=l}),{state:n,onConfirm:c,onCancel:h,selectItem:f}}}),Z={key:1,class:"fan-picker__o fan-flex fan-align-center fan-justify-between"},ee={class:"fan-picker__c"},te=y("div",{class:"fan-picker__b"},null,-1),ne=y("div",{class:"fan-picker__mask"},null,-1);function le(e,u,n,d,r,f){const c=b("FanButton"),h=b("FanText"),v=b("PickerColumn"),_=b("FanPopup");return m(),K(_,{show:e.state.innerShow,"onUpdate:show":u[0]||(u[0]=l=>e.state.innerShow=l),"safe-bottom":"",position:"bottom"},{default:x(()=>[y("div",null,[e.$slots.header?q(e.$slots,"header",{key:0}):(m(),V("div",Z,[S(c,{plain:"",border:!1,"text-size":"14","text-color":"#969799",onClick:e.onCancel},{default:x(()=>[w(p(e.cancelText),1)]),_:1},8,["onClick"]),S(h,{bold:"","text-size":"18",color:"#333"},{default:x(()=>[w(p(e.title),1)]),_:1}),S(c,{plain:"",border:!1,"text-size":"14","text-color":"var(--fan-primary-color)",onClick:e.onConfirm},{default:x(()=>[w(p(e.confirmText),1)]),_:1},8,["onClick"])])),y("div",ee,[(m(!0),V(F,null,I(e.state.list,(l,o)=>(m(),K(v,{ref_for:!0,ref:"column",key:o,items:l,value:e.state.selectValue,index:o,"value-key":e.valueKey,onSelectItem:e.selectItem},null,8,["items","value","index","value-key","onSelectItem"]))),128)),te,ne])])]),_:3},8,["show"])}const ce=E(X,[["render",le]]);export{ce as F};
