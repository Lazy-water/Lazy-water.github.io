import{B as j,C as T,M as E,o as d,a as N,h as z,c as h,w as k,x as y,g as I,I as w,f as O,i as W,n as $,d as F}from"./vue-libs-eb153a24.js";import{c as _,a as x,h as U}from"./helper-1e979f21.js";import{g as V,i as q}from"./index-5cf139c2.js";import{u as D}from"./index-b3ab7f5a.js";import{_ as H}from"./locales-2658cfbc.js";const J={customStyle:[Object,String],name:String,path:String,query:Object,redirect:Boolean,mp:Object,mpTag:{type:Boolean,default:!0},full:Boolean,schemeUrl:String,extras:[Object,String],zIndex:{type:[String,Number],default:1},block:Boolean,flex:Boolean,direction:{type:String,default:"row",validator:n=>["row","column"].includes(n)},align:{type:String,default:"center",validator:n=>["flex-start","center","flex-end"].includes(n)},justify:{type:String,validator:n=>["flex-start","center","flex-end","space-between","space-evenly","space-around"].includes(n)}};const P=j({name:_("Link")[0],options:{virtualHost:!0},emits:["click","launchedmp","failedmp"],props:J,setup(n,{emit:a}){const{navigate:v}=D(),{isWeixin:S}=V(),b=T(()=>{const{customStyle:t,zIndex:c,full:u,align:p,justify:m,flex:f}=n,o={};return u&&(o["z-index"]=c),f&&(p&&(o["align-items"]=p),m&&(o["justify-content"]=m)),x(t)+x(o)}),C=T(()=>{var t;return S&&!q()&&n.mpTag&&((t=n.mp)==null?void 0:t.originId)}),l=t=>{a("click",t);const{name:c,path:u,query:p,redirect:m,mp:f,schemeUrl:o,extras:B}=n;!c&&!u&&!o&&!f||v({name:c,path:u,query:p,redirect:m,mp:f,schemeUrl:o,extras:B})};let i=!1,s,r;const M=()=>{s&&(clearTimeout(s),s=null),r&&(clearTimeout(r),r=null)};E(()=>M());let g=!0;const L=async()=>{document.visibilityState!=="visible"&&(await U(300),i&&(g=!1,a("launchedmp",{message:"ok",success:!0}),console.log('emit("launchedmp"), 你打开了小程序')))};return{theStyle:b,showWxMpLaunchTag:C,onClick:l,onLaunchMpError:()=>{console.log("小程序标签拉起失败：",e),l(e),alert("打开失败："+JSON.stringify(e.detail))},onLaunchMp:async t=>{console.log("confirm acted..."),i=!0,M(),s=setTimeout(()=>{i=!1,document.removeEventListener("visibilitychange",L)},1500),r=setTimeout(()=>{g&&a("failedmp",{message:"fail cancel",success:!1})},350)},onClickMpTag:t=>{console.log("clicked..."),a("click",t),i=!1,g=!0,document.addEventListener("visibilitychange",L)}}}}),A=F("div",{class:"launch-mp-btn"},".",-1);function G(n,a,v,S,b,C){return d(),N("a",{style:W(n.theStyle),class:$(["fan-link",[{"fan-link--full":n.full},{"fan-link--block":n.block},{"fan-link--f":n.flex},{"fan-link--fcol":n.flex&&n.direction==="column"}]]),href:"javascript:void(0);",onClick:a[0]||(a[0]=w((...l)=>n.onClick&&n.onClick(...l),["stop"]))},[z(n.$slots,"default"),n.showWxMpLaunchTag?(d(),h(y("wx-open-launch-weapp"),{key:0,username:n.mp.originId,path:n.mp.path,class:"fan-launch-mp-mask",onError:n.onLaunchMpError,onLaunch:n.onLaunchMp,onClick:w(n.onClickMpTag,["stop"])},{default:k(()=>[(d(),h(y("script"),{type:"text/wxtag-template"},{default:k(()=>[(d(),h(y("style"),null,{default:k(()=>[I(" .launch-mp-btn { width: 100%;position: absolute;top: 0;bottom: 0;left: 0;right: 0 } ")]),_:1})),A]),_:1}))]),_:1},40,["username","path","onError","onLaunch","onClick"])):O("v-if",!0)],6)}const te=H(P,[["render",G]]);export{te as F};
